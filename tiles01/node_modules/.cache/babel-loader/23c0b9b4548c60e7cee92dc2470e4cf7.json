{"ast":null,"code":"'use strict';\n\nconst KillCursor = require('../connection/commands').KillCursor;\n\nconst MongoError = require('../error').MongoError;\n\nconst MongoNetworkError = require('../error').MongoNetworkError;\n\nconst collectionNamespace = require('./shared').collectionNamespace;\n\nconst maxWireVersion = require('../utils').maxWireVersion;\n\nconst command = require('./command');\n\nfunction killCursors(server, ns, cursorState, callback) {\n  callback = typeof callback === 'function' ? callback : () => {};\n  const cursorId = cursorState.cursorId;\n\n  if (maxWireVersion(server) < 4) {\n    const bson = server.s.bson;\n    const pool = server.s.pool;\n    const killCursor = new KillCursor(bson, ns, [cursorId]);\n    const options = {\n      immediateRelease: true,\n      noResponse: true\n    };\n\n    if (typeof cursorState.session === 'object') {\n      options.session = cursorState.session;\n    }\n\n    if (pool && pool.isConnected()) {\n      try {\n        pool.write(killCursor, options, callback);\n      } catch (err) {\n        if (typeof callback === 'function') {\n          callback(err, null);\n        } else {\n          console.warn(err);\n        }\n      }\n    }\n\n    return;\n  }\n\n  const killCursorCmd = {\n    killCursors: collectionNamespace(ns),\n    cursors: [cursorId]\n  };\n  const options = {};\n  if (typeof cursorState.session === 'object') options.session = cursorState.session;\n  command(server, ns, killCursorCmd, options, (err, result) => {\n    if (err) {\n      return callback(err);\n    }\n\n    const response = result.message;\n\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n\n    if (!Array.isArray(response.documents) || response.documents.length === 0) {\n      return callback(new MongoError(`invalid killCursors result returned for cursor id ${cursorId}`));\n    }\n\n    callback(null, response.documents[0]);\n  });\n}\n\nmodule.exports = killCursors;","map":{"version":3,"sources":["C:/Users/StuartGO/projects/bachelorOppgave/Tiles/tiles01/node_modules/mongodb/lib/core/wireprotocol/kill_cursors.js"],"names":["KillCursor","require","MongoError","MongoNetworkError","collectionNamespace","maxWireVersion","command","killCursors","server","ns","cursorState","callback","cursorId","bson","s","pool","killCursor","options","immediateRelease","noResponse","session","isConnected","write","err","console","warn","killCursorCmd","cursors","result","response","message","cursorNotFound","Array","isArray","documents","length","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nconst KillCursor = require('../connection/commands').KillCursor;\nconst MongoError = require('../error').MongoError;\nconst MongoNetworkError = require('../error').MongoNetworkError;\nconst collectionNamespace = require('./shared').collectionNamespace;\nconst maxWireVersion = require('../utils').maxWireVersion;\nconst command = require('./command');\n\nfunction killCursors(server, ns, cursorState, callback) {\n  callback = typeof callback === 'function' ? callback : () => {};\n  const cursorId = cursorState.cursorId;\n\n  if (maxWireVersion(server) < 4) {\n    const bson = server.s.bson;\n    const pool = server.s.pool;\n    const killCursor = new KillCursor(bson, ns, [cursorId]);\n    const options = {\n      immediateRelease: true,\n      noResponse: true\n    };\n\n    if (typeof cursorState.session === 'object') {\n      options.session = cursorState.session;\n    }\n\n    if (pool && pool.isConnected()) {\n      try {\n        pool.write(killCursor, options, callback);\n      } catch (err) {\n        if (typeof callback === 'function') {\n          callback(err, null);\n        } else {\n          console.warn(err);\n        }\n      }\n    }\n\n    return;\n  }\n\n  const killCursorCmd = {\n    killCursors: collectionNamespace(ns),\n    cursors: [cursorId]\n  };\n\n  const options = {};\n  if (typeof cursorState.session === 'object') options.session = cursorState.session;\n\n  command(server, ns, killCursorCmd, options, (err, result) => {\n    if (err) {\n      return callback(err);\n    }\n\n    const response = result.message;\n    if (response.cursorNotFound) {\n      return callback(new MongoNetworkError('cursor killed or timed out'), null);\n    }\n\n    if (!Array.isArray(response.documents) || response.documents.length === 0) {\n      return callback(\n        new MongoError(`invalid killCursors result returned for cursor id ${cursorId}`)\n      );\n    }\n\n    callback(null, response.documents[0]);\n  });\n}\n\nmodule.exports = killCursors;\n"]},"metadata":{},"sourceType":"script"}